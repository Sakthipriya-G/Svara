<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding-top: 50px;
      transition: background 0.3s, color 0.3s;
    }
    body.dark { background-color: #1c1c1c; color: #f1f1f1; }

    .container {
      background-color: #fff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    body.dark .container { background-color: #2c2c2c; }

    h1 { margin-bottom: 10px; }
    .subtitle { margin-bottom: 20px; color: #555; }
    body.dark .subtitle { color: #ccc; }

    input { width: 100%; padding: 10px; margin: 8px 0 15px; border-radius: 6px; border:1px solid #ccc; }
    input[disabled] { background-color: #e9e9e9; }
    body.dark input[disabled] { background-color: #444; color: #eee; border:1px solid #555; }

    .buttons button {
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      transition: 0.2s;
    }
    .reset-btn { background-color: #007bff; color: #fff; }
    .delete-btn { background-color: #dc3545; color: #fff; }
    .change-password { background-color: #6c757d; color: #fff; }
    .logout-btn { background-color: #28a745; color: #fff; }
    .buttons button:hover { opacity:0.9; transform: scale(1.02); }

    .theme-toggle {
      cursor: pointer;
      font-size: 20px;
      float: right;
      margin-top: -40px;
    }

    .back-icon {
      text-decoration: none;
      font-size: 18px;
      color: #333;
      float: left;
      margin-bottom: 10px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      text-align: left;
    }
    body.dark .modal-content { background-color: #2c2c2c; color: #fff; }

    .modal-content h3 { margin-bottom: 15px; }
    .modal-content input { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
    .modal-actions { text-align: right; }
    .modal-actions button { margin-left: 10px; padding: 8px 12px; border-radius: 6px; cursor: pointer; border:none; }
  </style>
</head>
<body>

<div class="container">
  <a href="home.html" class="back-icon"><i class="fas fa-arrow-left"></i> Back</a>
  <h1>⚙️ Settings</h1>
  <i class="fas fa-moon theme-toggle" id="themeToggle"></i>
  <p class="subtitle">Manage your account</p>

  <form class="settings-form">
    <label for="username">Username</label>
    <input type="text" id="username" placeholder="Your username">

    <label for="email">Email (read-only)</label>
    <input type="text" id="email" disabled>

    <div class="buttons">
      <button type="button" class="change-password" id="passwordBtn">Change Password</button>
      <button type="button" class="logout-btn" id="logoutBtn">Logout</button>
      <button type="button" class="delete-btn" id="deleteBtn">Delete Account</button>
    </div>
  </form>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Edit</h3>
    <div id="modalBody"></div>
    <div class="modal-actions">
      <button onclick="closeModal()">Cancel</button>
      <button id="saveBtn">Save</button>
    </div>
  </div>
</div>

<script>
  const usernameInput = document.getElementById("username");
  const emailInput = document.getElementById("email");
  const modal = document.getElementById("modal");
  const modalBody = document.getElementById("modalBody");
  const saveBtn = document.getElementById("saveBtn");
  let currentField = null;

  // Load user data from localStorage
  const user = JSON.parse(localStorage.getItem("svara_user") || "{}");
  usernameInput.value = user.username || "";
  emailInput.value = user.email || "";

  // Save username live
  usernameInput.addEventListener("input", (e) => {
    user.username = e.target.value;
    localStorage.setItem("svara_user", JSON.stringify(user));
  });

  // Change password
  document.getElementById("passwordBtn").addEventListener("click", () => {
    openModal("Change Password", `
      <input type='password' id='oldPass' placeholder='Old Password'>
      <input type='password' id='newPass' placeholder='New Password'>
      <input type='password' id='confirmPass' placeholder='Confirm New Password'>
    `, "password");
  });

  function openModal(title, body, field) {
    modal.querySelector("h3").textContent = title;
    modalBody.innerHTML = body;
    modal.style.display = "flex";
    currentField = field;
  }
  function closeModal() { modal.style.display = "none"; }

  saveBtn.addEventListener("click", () => {
    if(currentField === "password") {
      const newPass = document.getElementById("newPass").value;
      const confirmPass = document.getElementById("confirmPass").value;
      if(newPass.length < 6) { alert("Password too short!"); }
      else if(newPass !== confirmPass) { alert("Passwords do not match!"); }
      else { alert("Password updated!"); closeModal(); }
    }
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", () => {
    if(confirm("Do you really want to logout?")) {
      window.location.href = "login.html";
    }
  });

  // Delete Account
  document.getElementById("deleteBtn").addEventListener("click", () => {
    if(confirm("Are you sure you want to delete your account? This cannot be undone.")) {
      localStorage.removeItem("svara_user");
      alert("Account deleted. Please register again.");
      window.location.href = "signup.html";
    }
  });

  // Dark/light mode toggle
  const themeToggle = document.getElementById("themeToggle");
  themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    themeToggle.classList.toggle("fa-sun");
    themeToggle.classList.toggle("fa-moon");
    localStorage.setItem("svara_theme", document.body.classList.contains("dark") ? "dark" : "light");
  });

  // Load saved theme
  if(localStorage.getItem("svara_theme") === "dark") {
    document.body.classList.add("dark");
    themeToggle.classList.add("fa-sun");
    themeToggle.classList.remove("fa-moon");
  }
</script>

</body>
</html>
